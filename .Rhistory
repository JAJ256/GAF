expand = c(0,0)
)+
ggtitle("ATAC 130-200 bp")+
facet_grid(~class)
# G - NURF GBupRNAup and GBupRNAdown sorted PRO-seq metaprofiles
NURFupRNAup_PR.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(NURFupRNAup.gr, 0, 150),
binsize = 2,
first.output.xval = 0,
expand_ranges = FALSE
)
NURFupRNAup_PR.mat$class <- "up_up"
NURFupRNAdown_PR.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(NURFupRNAdown.gr, 0, 150),
binsize = 2,
first.output.xval = 0,
expand_ranges = FALSE
)
NURFupRNAdown_PR.mat$class <- "up_down"
NURFupRNAup_GB.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(NURFupRNAup.gr, 0, 1500),
binsize = 20,
first.output.xval = 0,
expand_ranges = FALSE
)
NURFupRNAup_GB.mat$class <- "up_up"
NURFupRNAdown_GB.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(NURFupRNAdown.gr, 0, 1500),
binsize = 20,
first.output.xval = 0,
expand_ranges = FALSE
)
NURFupRNAdown_GB.mat$class <- "up_down"
# Filling sample.name column and factoring
NURFupRNAup_PR.mat$sample.name <-
factor(
NURFupRNAup_PR.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
NURFupRNAdown_PR.mat$sample.name <-
factor(
NURFupRNAdown_PR.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
NURFupRNAup_GB.mat$sample.name <-
factor(
NURFupRNAup_GB.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
NURFupRNAdown_GB.mat$sample.name <-
factor(
NURFupRNAdown_GB.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
nurfSorted_PR.mat <- rbind(
NURFupRNAup_PR.mat, NURFupRNAdown_PR.mat
)
nurfSorted_GB.mat <- rbind(
NURFupRNAup_GB.mat, NURFupRNAdown_GB.mat
)
# Plotting promoter
S8Ga <- ggMetaplot(nurfSorted_PR.mat)+
gg_color_scale_RNAi_PROseq +
gg_fill_scale_RNAi_PROseq +
scale_x_continuous(
limits = c(0, 150),
expand = c(0,0),
breaks = c(0, 50, 100, 150)
) +
scale_y_continuous(
breaks = c(0, 50, 100, 150)
) +
coord_cartesian(
ylim = c(0, 150),
expand = FALSE,
)+
ggtitle("PRO-seq")+
facet_grid(class~.)
# Plotting gene body
S8Gb <- ggMetaplot(nurfSorted_GB.mat)+
gg_color_scale_RNAi_PROseq +
gg_fill_scale_RNAi_PROseq +
scale_y_continuous(
breaks = c(0, 1, 2, 3)
)+
scale_x_continuous(
breaks = c(seq(150, 1500, length.out = 4))
)+
coord_cartesian(
xlim = c(150, 1500),
ylim = c(0, 3),
expand = 0,
) +
ylab(NULL)+
facet_grid(class~.)
S8_BCD <- (plot_spacer() | S8B | S8C | S8D) +
plot_layout(guides = "collect")+
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(
family = "Helvetica", face = "bold", size = 12))
S8EF <-  (S8E / S8F) + plot_layout(guides = "collect")+
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(family = "Helvetica", face = "bold", size = 12))
S8G <-  (S8Ga | S8Gb) + plot_layout(guides = "collect")+
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(
family = "Helvetica", face = "bold", size = 12))
S8_BCD
S8EF
S8G
# A - MA plot of GAF vs PBAP PR
# Getting df of promoter counts
PR.df <- data.frame(PR.tbl, row.names = "tx_name")
PR_col_data.df <- data.frame(
row.names = colnames(PR.df),
RNAi = c(
"BAP170",
"BAP170",
"GAF",
"GAF",
"LACZ",
"LACZ",
"NURFBAP",
"NURFBAP",
"NURF301",
"NURF301"
)
)
# A - MA plot of GAF vs. PBAP ATAC peaks
# Getting counts table
ATAC_peaks.df <- data.frame(ATAC_peaks.tbl, row.names = "peak_name")
ATAC_peaks_col_data.df <- data.frame(
row.names = colnames(ATAC_peaks.df),
RNAi = c(
"BAP170",
"BAP170",
"GAF",
"GAF",
"LACZ",
"LACZ",
"NURFBAP",
"NURFBAP",
"NURF301",
"NURF301"
)
)
# Running DESeq2
ATAC_peaks_GAFvsBAP.res <-
subset_DESeq.jj(ATAC_peaks.df,
ATAC_peaks_col_data.df,
scale_facts_ATACDHS.dbl,
c(3,4,1,2),
c("RNAi", "GAF", "BAP170"),
~RNAi)
# Running DESeq2
ATAC_peaks_GAFvsBAP.res <-
subset_DESeq.jj(ATAC_peaks.df,
ATAC_peaks_col_data.df,
scale_facts_ATACDHS.dbl,
c(3,4,1,2),
c("RNAi", "GAF", "BAP170"),
~RNAi)
## Plotting
S9D <- maplot.jj(ATAC_peaks_GAFvsBAP.res)+
scale_y_continuous(limits = c(-10, 10), breaks = c(-10,-5,0,5,10), expand= c(0,0)
# Plotting
S9A <- maplot.jj(ATAC_peaks_GAFvsBAP.res)+
# Plotting
S9A <- maplot.jj(ATAC_peaks_GAFvsBAP.res)+
scale_y_continuous(limits = c(-10, 10), breaks = c(-10,-5,0,5,10), expand= c(0,0))
S9A
# E - Venn diagram of GAF and PBAP promoter intersections
# Getting lists of GAF and BAP dependent pause genes
bapDepGenes.chr <- rownames(PR_BAP.res[which(PR_BAP.res$padj < 0.01 &
PR_BAP.res$log2FoldChange < 0), ])
# Defining 3 sets of genes:
# GAF-independent but BAP-dependent
gafIndBapDep.gr <- genes.gr[
genes.gr$tx_name %in% bapDepGenes.chr & !genes.gr$tx_name %in% gafDepGenes.chr,
]
# Defining 3 sets of genes:
# GAF-independent but BAP-dependent
gafIndBapDep.gr <- genes.gr[
genes.gr$tx_name %in% bapDepGenes.chr & !genes.gr$tx_name %in% gafDepGenes.chr,
]
# E - Venn diagram of GAF and PBAP promoter intersections
# Getting lists of GAF and BAP dependent pause genes
bapDepGenes.chr <- rownames(
PR_BAP.res[which(PR_BAP.res$padj < 0.01 & PR_BAP.res$log2FoldChange < 0), ])
gafDepGenes.chr <- rownames(
PR_GAF.res[which(PR_GAF.res$padj < 0.01 & PR_GAF.res$log2FoldChange < 0), ])
# Defining 3 sets of genes:
# GAF-independent but BAP-dependent
gafIndBapDep.gr <- genes.gr[
genes.gr$tx_name %in% bapDepGenes.chr & !genes.gr$tx_name %in% gafDepGenes.chr,
]
## GAF- and BAP-dependent
gafDepBapDep.gr <- genes.gr[
genes.gr$tx_name %in% gafDepGenes.chr & genes.gr$tx_name %in% bapDepGenes.chr
]
# GAF-dependent but BAP-independent
gafDepBapInd.gr <- genes.gr[
genes.gr$tx_name %in% gafDepGenes.chr & !genes.gr$tx_name %in% bapDepGenes.chr,
]
# Plotting Euler diagram (area-proportional Venn diagram)
S9B <- plot(euler(c("GAF" = length(gafDepBapInd.gr),
"BAP" = length(gafIndBapDep.gr),
"GAF&BAP" = length(gafDepBapDep.gr)),
shape = "ellipse"),
quantities = TRUE)
S9B
# C - ATAC-seq metaprofiles of three classes
# Getting counts matrix of ATAC data
gafIndBapDep_ATACDHSSub.mat <-
metaSubsample(
dataset.gr = ATACDHS_normed_merged.lst,
regions.gr = promoters(gafIndBapDep.gr, 500, 500),
binsize = 1,
first.output.xval = -500,
expand_ranges = TRUE
)
gafDepBapDep_ATACDHSSub.mat <-
metaSubsample(
dataset.gr = ATACDHS_normed_merged.lst,
regions.gr = promoters(gafDepBapDep.gr, 500, 500),
binsize = 1,
first.output.xval = -500,
expand_ranges = TRUE
)
gafDepBapInd_ATACDHSSub.mat <-
metaSubsample(
dataset.gr = ATACDHS_normed_merged.lst,
regions.gr = promoters(gafDepBapInd.gr, 500, 500),
binsize = 1,
first.output.xval = -500,
expand_ranges = TRUE
)
# Factoring sample.name column
gafIndBapDep_ATACDHSSub.mat$sample.name <-
factor(
gafIndBapDep_ATACDHSSub.mat$sample.name,
levels = names(ATACDHS_normed_merged.lst)
)
gafDepBapDep_ATACDHSSub.mat$sample.name <-
factor(
gafDepBapDep_ATACDHSSub.mat$sample.name,
levels = names(ATACDHS_normed_merged.lst)
)
gafDepBapInd_ATACDHSSub.mat$sample.name <-
factor(
gafDepBapInd_ATACDHSSub.mat$sample.name,
levels = names(ATACDHS_normed_merged.lst)
)
# Plotting
S9Fa <- ggMetaplot(gafDepBapInd_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
# Plotting
S9Ca <- ggMetaplot(gafDepBapInd_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
S9Cb <- ggMetaplot(gafDepBapDep_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
S9Cc <- ggMetaplot(gafIndBapDep_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
# H - GAF ChIP-seq of three classes
# Getting signal DF
gafBapDepSorted_GAFChIP.df <-
data.frame(
"x" = rep(seq(-497.5, 497.5, 5), 3),
"signal" = c(
colMeans(getCountsByPositions(
ChIP.lst$GAF_ChIPseq,
promoters(gafDepBapInd.gr, 500, 500),
binsize = 5,
expand_ranges = TRUE
)),
colMeans(getCountsByPositions(
ChIP.lst$GAF_ChIPseq,
promoters(gafDepBapDep.gr, 500, 500),
binsize = 5,
expand_ranges = TRUE
)),
colMeans(getCountsByPositions(
ChIP.lst$GAF_ChIPseq,
promoters(gafIndBapDep.gr, 500, 500),
binsize = 5,
expand_ranges = TRUE
))
),
"class" = c(
rep("gafDepBapInd", 200),
rep("gafDepBapDep", 200),
rep("gafIndBapDep", 200)
)
)
S
# Plotting
S9C <- ggplot(gafBapDepSorted_GAFChIP.df,
aes(x = x, y = signal, color = class))+
geom_line()+
ggtheme.jj()+
scale_x_continuous(expand = c(0,0))+
scale_y_continuous(limits = c(0, 75), breaks = c(0, 25, 50, 75), expand = c(0,0))+
ylab("Mean")+
xlab("Distance from TSS")+
ggtitle("GAF ChIP-seq")
# C - ATAC-seq metaprofiles of three classes
# Getting counts matrix of ATAC data
gafIndBapDep_ATACDHSSub.mat <-
metaSubsample(
dataset.gr = ATACDHS_normed_merged.lst,
regions.gr = promoters(gafIndBapDep.gr, 500, 500),
binsize = 1,
first.output.xval = -500,
expand_ranges = TRUE
)
# Plotting
S9Da <- ggMetaplot(gafDepBapInd_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
S9Db <- ggMetaplot(gafDepBapDep_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
S9Dc <- ggMetaplot(gafIndBapDep_ATACDHSSub.mat) +
gg_color_scale_RNAi_ATACDHS +
gg_fill_scale_RNAi_ATACDHS +
scale_x_continuous(
limits = c(-500, 500),
expand = c(0,0)
) +
scale_y_continuous(
limits = c(0, 200),
expand = c(0,0)
)+
ggtitle("ATAC < 120 bp")
gafIndBapDep_proSeqSubPR.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(gafIndBapDep.gr, 0, 150),
binsize = 2,
first.output.xval = 0,
expand_ranges = FALSE
)
gafDepBapDep_proSeqSubPR.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(gafDepBapDep.gr, 0, 150),
binsize = 2,
first.output.xval = 0,
expand_ranges = FALSE
)
gafDepBapInd_proSeqSubPR.mat <-
metaSubsample(
dataset.gr = PROseq_normed_merged.lst,
regions.gr = promoters(gafDepBapInd.gr, 0, 150),
binsize = 2,
first.output.xval = 0,
expand_ranges = FALSE
)
# Filling sample.name column and factoring
gafIndBapDep_proSeqSubPR.mat$sample.name <-
factor(
gafIndBapDep_proSeqSubPR.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
gafDepBapDep_proSeqSubPR.mat$sample.name <-
factor(
gafDepBapDep_proSeqSubPR.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
gafDepBapInd_proSeqSubPR.mat$sample.name <-
factor(
gafDepBapInd_proSeqSubPR.mat$sample.name,
levels = names(PROseq_normed_merged.lst)
)
# Plotting promoter
S9Ea <- ggMetaplot(gafDepBapInd_proSeqSubPR.mat)+
gg_color_scale_RNAi_PROseq +
gg_fill_scale_RNAi_PROseq +
scale_x_continuous(
limits = c(0, 150),
expand = c(0,0),
breaks = c(0, 50, 100, 150)
) +
scale_y_continuous(
breaks = c(0, 25, 50, 75)
) +
coord_cartesian(
ylim = c(0, 75),
expand = 0,
)+
ggtitle("PRO-seq")
S9Eb <- ggMetaplot(gafDepBapDep_proSeqSubPR.mat)+
gg_color_scale_RNAi_PROseq +
gg_fill_scale_RNAi_PROseq +
scale_x_continuous(
limits = c(0, 150),
expand = c(0,0),
breaks = c(0, 50, 100, 150)
) +
scale_y_continuous(
breaks = c(0, 25, 50, 75)
) +
coord_cartesian(
ylim = c(0, 75),
expand = 0,
)+
ggtitle("PRO-seq")
S9Ec <- ggMetaplot(gafIndBapDep_proSeqSubPR.mat)+
gg_color_scale_RNAi_PROseq +
gg_fill_scale_RNAi_PROseq +
scale_x_continuous(
limits = c(0, 150),
expand = c(0,0),
breaks = c(0, 50, 100, 150)
) +
scale_y_continuous(
breaks = c(0,25, 50, 75)
) +
coord_cartesian(
ylim = c(0, 75),
expand = 0,
)+
ggtitle("PRO-seq")
# I - motif analysis
# Saving bed files of promoters. I'll take these, use
# bedtools getfasta -s to get stranded sequences, and
# then use DREME to search gafIndBapDep and gafDepBapInd
# vs. gafDepBapDep using DREME, e < 0.001.
# Then input found motifs in TomTom
export.bed(unique(
promoters(gafIndBapDep.gr, 500, 0)), "bed/gafIndBapDep.bed")
export.bed(unique(
promoters(gafDepBapInd.gr, 500, 0)), "bed/gafDepBapInd.bed")
export.bed(unique(
promoters(gafDepBapDep.gr, 500, 0)), "bed/gafDepBapDep.bed")
S9_layout <- "
ABBC
#DEF
#GHI
"
S9_all <- S9A + S9B + S9C + S9Da + S9Db + S9Dc + S9Ea + S9Eb + S9Ec +
plot_layout(guides = "collect", design = S9_layout)+
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(
family = "Helvetica", face = "bold", size = 12))
S9_all
